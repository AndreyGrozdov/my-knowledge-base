# Проблема обновления приложений
Предположим, у нас есть приложение версии 1.0. Разработчики выпускают новую версию 2.0, которую мы собираем в Docker-образ и загружаем в registry. Теперь необходимо обновить все Pod'ы в кластере Kubernetes, чтобы они использовали новый образ 2.0.
Основная сложность: мы не можем заменить образ уже запущенного Pod'а. После создания Pod остаётся неизменным до своего удаления.

### Три базовых подхода к обновлению
   1. Удалить все существующие Pod'ы, затем запустить новые
       ◦ Простой подход, но приводит к downtime приложения
       ◦ Между удалением старых и запуском новых Pod'ов приложение недоступно
   2. Запустить новые Pod'ы, затем удалить старые
       ◦ Избегаем downtime, но временно работают две версии приложения
       ◦ Проблема: версия 2.0 может накатывать миграции базы данных, несовместимые с версией 1.0
   3. Поэтапное обновление
       ◦ Добавляем по одному новому Pod'у, удаляем по одному старому
       ◦ Минимизирует риски, но требует ручного управления процессом
### Решение: Deployment
#### Deployment - это объект Kubernetes, предназначенный для декларативного управления развертыванием и обновлением приложений. Он автоматически координирует создание и изменение ReplicaSet'ов во время обновления

Как работает Deployment:
Deployment создает и управляет двумя ReplicaSet'ами:
Во время обновления Deployment:
- Автоматически откатывает изменения при возникновении проблем
- Обеспечивает, что в любой момент времени работает нужное количество Pod'ов
- Соответственно уменьшает количество реплик в старом ReplicaSet
- Постепенно увеличивает количество реплик в новом ReplicaSet
- Новый ReplicaSet - управляет Pod'ами новой версии
- Старый ReplicaSet - управляет Pod'ами предыдущей версии
#### Преимущества Deployment
- Декларативный подход - описываем желаемое состояние, Kubernetes сам достигает его
- Health checks - проверяет готовность новых Pod'ов перед удалением старых
- Автоматический rollback - при неудачном обновлении автоматически возвращается к предыдущей версии
- Zero-downtime deployments - приложение доступно throughout всего процесса обновления
_________________________________________________________________________________________________
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: app
  template:
    metadata:
      labels:
        app: app
    spec:
      containers:
      - name: app
        image: app:v1.0
```
__________________________________________________________________________________________
# Команды:

```bash
kubectl create -f deployment.yaml                                             #создание деплоя из ямл файла   можно подставить --record для записи измкенений
kubectl get deployment                                                                #Посмотреть созданный деплой
kubectl rollout status deployment qa-deployment                #Посмотреть статус деплоя  (вместо qa-deployment подставить своё имя деплоя)
kubectl get replicaset                                                                    #Посмотреть replicaset которую создал наш деплой
kubectl delete deployment qa-deployment                            #Удалить деплоймент (вместо qa-deployment подставить своё имя деплоя)
```
____________________________________________________________________________________________
Стратегия обновления подов
RollingUpdate - удаляет старые поды и одновременно добавляет новые .
Recreate - удаляет все старые модули перед созданием новых.
